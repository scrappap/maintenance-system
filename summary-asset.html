<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>list</title>
<link rel="icon" type="image/png" href="img/JKB logo.png">

<style>
body{
margin:0;font-family:'Segoe UI',Arial,sans-serif;background:#0b1118;color:#cfefff}
body::before{content:"";position:fixed;inset:0;background-image:linear-gradient(rgba(0,255,255,.04) 1px, transparent 1px),linear-gradient(90deg, rgba(0,255,255,.04) 1px, transparent 1px);background-size:40px 40px;pointer-events:none}
  margin:0;
  font-family:'Segoe UI',Arial,sans-serif;
  background:#0b1118;
  color:#cfefff;
}

.header{
  background:#0f1822;
  padding:15px 20px;
  border-bottom:1px solid #00e5ff33;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.title{
  font-size:18px;
  font-weight:600;
  color:#00e5ff;
}

.container{
  padding:20px;
}

.card{
  background:#121c26;
  border:1px solid #00e5ff33;
  border-radius:12px;
  padding:12px;
  margin-bottom:15px;
}

.btn{
  border:1px solid #00e5ff55;
  background:#111a24;
  color:#00e5ff;
  padding:6px 12px;
  font-size:12px;
  border-radius:6px;
  cursor:pointer;
}

.btn:hover{
  background:#00e5ff22;
}

input,select{
  background:#0f1822;
  border:1px solid #00e5ff33;
  color:#00e5ff;
  border-radius:6px;
  padding:5px;
  font-size:12px;
}

table{
  width:100%;
  border-collapse:collapse;
}

th{
  background:#081018;
  color:#00e5ff;
  font-size:11px;
  text-transform:uppercase;
  border-bottom:1px solid #00e5ff55;
  position:sticky;
  top:0;
}

th,td{
  padding:8px 10px;
  font-size:12px;
  border-bottom:1px solid #1e2b36;
}

tr:hover{
  background:#00e5ff11;
}
/* ACTION BAR GOLD STYLE */
.action-bar{
  color: #FFD700; /* gold */
}

.action-bar .btn{
  color: #FFD700;
  border-color: #FFD70055;
}

.action-bar .btn:hover{
  background: #FFD70022;
  box-shadow: 0 0 6px #FFD700;
}

.action-bar input,
.action-bar select{
  color: #FFD700;
  border-color: #FFD70055;
}
.viewIcon{
  margin-left:8px;
  cursor:pointer;
  font-size:13px;
  color:#FFD700; /* gold */
  transition:0.2s;
}

.viewIcon:hover{
  color:#00e5ff;
  transform:scale(1.2);
}
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.7);
  backdrop-filter:blur(5px);
  justify-content:center;
  align-items:center;
  z-index:9999;
}

.modal-content{
  background:#121c26;
  border:1px solid #FFD70055;
  border-radius:14px;
  padding:20px;
  width:400px;
  color:#FFD700;
  box-shadow:0 0 20px #FFD70033;
  animation:fadeIn .2s ease-in-out;
}

.closeBtn{
  float:right;
  cursor:pointer;
  color:#ff3b3b;
  font-weight:bold;
}

.viewIcon{
  cursor:pointer;
  transition:0.2s;
}

.viewIcon:hover svg path,
.viewIcon:hover svg circle{
  stroke:#00e5ff;
}

@keyframes fadeIn{
  from{transform:scale(.9);opacity:0}
  to{transform:scale(1);opacity:1}
}
</style>
</head>

<!-- ADD ASSET MODAL -->
<div id="addModal" class="modal">
  <div class="modal-content">
    <span class="closeBtn" onclick="closeAddModal()">✖</span>
    <h3>Add New Asset</h3>

    <div style="display:flex;flex-direction:column;gap:10px;margin-top:15px;">

      <input type="text" id="newAssetNo" placeholder="Asset No">
      <input type="text" id="newType" placeholder="Type Code">
      <input type="text" id="newDesc" placeholder="Description">
      <input type="text" id="newDiscipline" placeholder="Discipline">
      <input type="text" id="newLocation" placeholder="Location">

      <select id="newFrequency">
        <option value="">Select Frequency</option>
        <option>Monthly</option>
        <option>Quarterly</option>
        <option>Semi Annual</option>
        <option>Annual</option>
      </select>

      <input type="date" id="newDate">

      <button class="btn" onclick="saveNewAsset()">Save</button>

    </div>
  </div>
</div>
</div>

<body>

<div class="header">
  <div class="title">Summary Asset</div>
  <button class="btn btn-back" onclick="goBack()">← Back</button>
</div>


<div class="container">

  <!-- ACTION BAR -->
  <div class="card action-bar" style="display:flex;flex-wrap:wrap;gap:10px;align-items:center;">
    <button class="btn" onclick="addRow()">Add</button>
    <button class="btn" onclick="deleteSelected()">Delete</button>

    <input type="text" id="searchBox" placeholder="Search..." onkeyup="searchTable()">

    <select id="filterDiscipline" onchange="filterTable()">
      <option value="">All Discipline</option>
    </select>

    <select id="filterLocation" onchange="filterTable()">
      <option value="">All Location</option>
    </select>
  </div>

  <!-- TABLE -->
  <div class="card" style="max-height:500px;overflow:auto">
    <table id="assetTable">
      <thead>
        <tr>
          <th></th>
          <th>Asset No</th>
          <th>Type Code</th>
          <th>Description</th>
          <th>Discipline</th>
          <th>Location</th>
          <th>Frequency</th>
          <th>Target Date</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<script>

<script>

let data = [];

/* =========================
   LOAD DATA FROM GOOGLE SHEET
========================= */

async function loadData(){
  try{
    const response = await fetch("https://script.google.com/macros/s/AKfycbw6pKlFoXafnSGlplNh6K7IRpgzewIkQ-MvbT-sJ_cj_kvkvYMQyAsMfcWgFrL6voLzNQ/exec");
    data = await response.json();

    renderTable();
    populateFilters();
  }catch(error){
    console.error("Error loading data:", error);
    alert("Failed to load data from Google Sheet");
  }
}


/* =========================
   RENDER TABLE
========================= */

function renderTable(){
  const tbody = document.querySelector("#assetTable tbody");
  tbody.innerHTML="";

  data.forEach((row,i)=>{
    tbody.innerHTML += `
      <tr>
        <td><input type="checkbox" data-index="${i}"></td>
        <td style="display:flex;align-items:center;gap:8px;">
          ${row.assetNo}
          <span class="viewIcon" onclick="viewAsset('${row.assetNo}')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M2 12C2 12 6 5 12 5C18 5 22 12 22 12C22 12 18 19 12 19C6 19 2 12 2 12Z" stroke="#FFD700" stroke-width="2"/>
              <circle cx="12" cy="12" r="3" stroke="#FFD700" stroke-width="2"/>
            </svg>
          </span>
        </td>
        <td>${row.type || ""}</td>
        <td>${row.desc || ""}</td>
        <td>${row.discipline || ""}</td>
        <td>${row.location || ""}</td>
        <td>${row.frequency || ""}</td>
        <td>${row.date || ""}</td>
      </tr>
    `;
  });
}


/* =========================
   POPULATE FILTER DROPDOWN
========================= */

function populateFilters(){

  const disciplineSet = new Set();
  const locationSet = new Set();

  data.forEach(row=>{
    if(row.discipline) disciplineSet.add(row.discipline);
    if(row.location) locationSet.add(row.location);
  });

  const disciplineSelect = document.getElementById("filterDiscipline");
  const locationSelect = document.getElementById("filterLocation");

  disciplineSelect.innerHTML = `<option value="">All Discipline</option>`;
  locationSelect.innerHTML = `<option value="">All Location</option>`;

  disciplineSet.forEach(d=>{
    disciplineSelect.innerHTML += `<option value="${d}">${d}</option>`;
  });

  locationSet.forEach(l=>{
    locationSelect.innerHTML += `<option value="${l}">${l}</option>`;
  });
}


/* =========================
   FILTER TABLE
========================= */

function filterTable(){
  const dVal = document.getElementById("filterDiscipline").value;
  const lVal = document.getElementById("filterLocation").value;
  const rows=document.querySelectorAll("#assetTable tbody tr");

  rows.forEach(row=>{
    const discipline=row.children[4].innerText;
    const location=row.children[5].innerText;

    let show=true;

    if(dVal && discipline!==dVal) show=false;
    if(lVal && location!==lVal) show=false;

    row.style.display = show ? "" : "none";
  });
}


/* =========================
   SEARCH
========================= */

function searchTable(){
  const keyword=document.getElementById("searchBox").value.toLowerCase();
  const rows=document.querySelectorAll("#assetTable tbody tr");

  rows.forEach(row=>{
    row.style.display = row.innerText.toLowerCase().includes(keyword) ? "" : "none";
  });
}


/* =========================
   DELETE SELECTED (FRONTEND)
========================= */

function deleteSelected(){

  const checkboxes=document.querySelectorAll("#assetTable tbody input[type='checkbox']");
  
  data = data.filter((row,i)=> !checkboxes[i].checked);
  
  renderTable();
  populateFilters();
}


/* =========================
   VIEW ASSET
========================= */

function viewAsset(assetNo){
  window.location.href = "asset-detail.html?asset=" + assetNo;
}


/* =========================
   BACK BUTTON
========================= */

function goBack(){
  if (document.referrer !== "") {
    window.history.back();
  } else {
    window.location.href = "index.html";
  }
}


/* =========================
   INIT
========================= */

loadData();

/* =========================
   ADD
========================= */

function addRow(){
  document.getElementById("addModal").style.display="flex";
}

/* =========================
   CLOSE & SAVE
========================= */

function closeAddModal(){
  document.getElementById("addModal").style.display="none";
}

async function saveNewAsset(){

  const assetNo = document.getElementById("newAssetNo").value.trim();
  const type = document.getElementById("newType").value.trim();
  const desc = document.getElementById("newDesc").value.trim();
  const discipline = document.getElementById("newDiscipline").value.trim();
  const location = document.getElementById("newLocation").value.trim();
  const frequency = document.getElementById("newFrequency").value;
  const date = document.getElementById("newDate").value;

  if(!assetNo || !date || !frequency){
    alert("Asset No, Frequency dan Date wajib isi");
    return;
  }

  const response = await fetch("PASTE_WEB_APP_URL_HERE",{
    method:"POST",
    body: JSON.stringify({
      assetNo,
      type,
      desc,
      discipline,
      location,
      frequency,
      date
    })
  });

  const result = await response.json();

  if(result.status === "duplicate"){
    alert("Asset No already exists!");
    return;
  }

  if(result.status === "success"){
    alert("Asset successfully added!");

    closeAddModal();
    loadData(); // reload table
  }
}

</script>

</script>

</body>
</html>